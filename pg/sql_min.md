# Тестовое задание - PostgreSQL (общий минимум)

## Задания

### 1. **Проектирование БД**
1.1. Написать SQL (DDL) для создания таблиц `orders` и `shipments` с:
- Primary / Foreign keys
- `NOT NULL`, `CHECK`, корректные типы данных
- Индексы для поиска по `due_date`, `priority`, `product`

1.2. Добавить в `orders` поле `status`, которое должно отражать состояние исполнения:
- `pending` — нет отгрузок
- `partial` — отгружено < quantity
- `completed` — полностью отгружено

---

### 2. **SQL-аналитика**
Написать запросы:

2.1. Список заказов с процентом выполнения  
2.2. ТОП-3 продукта по суммарному количеству заказов  
2.3. Просроченные заказы (не выполнены и `due_date < today`)  
2.4. Кумулятивный объём отгрузок по датам (оконная функция)

---

### 3. **Функции и триггеры (PL/pgSQL)**

3.1. Функция `fn_order_fill_rate(p_order_id)` → возвращает % выполнения заказа  
3.2. Триггер на `shipments`, который обновляет `orders.status`  
3.3. Процедура `sp_bulk_load_orders(json)` для массовой загрузки заказов

---

### 4. **Оптимизация**

Кандидату будет предоставлен “медленный запрос” — нужно:

4.1. Проанализировать `EXPLAIN ANALYZE`  
4.2. Предложить оптимизацию (индексы / рефакторинг запроса)  
4.3. Показать сравнение **до/после**

---

### 5. **Администрирование PostgreSQL**

5.1. Создать пользователей и права:
- `frepple_app` → доступ на запись в схему `app`
- `report_user` → только SELECT

5.2. Настроить бэкапы:
- ежедневный `pg_dump`
- хранение 7 дней
- пример restore-проверки

5.3. Объяснить назначение параметров:
- `shared_buffers`
- `work_mem`
- `maintenance_work_mem`
- `effective_cache_size`

5.4. Описать:
- механизмы репликации (WAL, физическая и логическая, replication slots)
- настройку `pg_hba.conf` (безопасный доступ)

---

## Результат сдачи

Кандидат должен предоставить:

✅ SQL-скрипты  
✅ Краткий отчет с пояснениями принятых решений  
✅ (Будет плюсом) `docker-compose.yml` с PostgreSQL  
✅ (Будет плюсом) пример автоматизации бэкапов

---

## Критерии оценки

| Критерий | Баллы (0–2) |
|---|---:|
| Корректность схемы БД | ☐ 0 ☐ 1 ☐ 2 |
| Индексы и оптимизация | ☐ 0 ☐ 1 ☐ 2 |
| Аналитические SQL | ☐ 0 ☐ 1 ☐ 2 |
| PL/pgSQL (функции, триггеры) | ☐ 0 ☐ 1 ☐ 2 |
| Понимание `EXPLAIN` | ☐ 0 ☐ 1 ☐ 2 |
| Роли и безопасность | ☐ 0 ☐ 1 ☐ 2 |
| Бэкапы и восстановление | ☐ 0 ☐ 1 ☐ 2 |
| Конфигурация сервера | ☐ 0 ☐ 1 ☐ 2 |
| Репликация | ☐ 0 ☐ 1 ☐ 2 |
| Качество оформления | ☐ 0 ☐ 1 ☐ 2 |

**Максимум: 20 баллов**

| Баллы | Уровень кандидата |
|---:|---|
| 18–20 | Отлично |
| 14–17 | Хороший уровень |
| 10–13 | Базовый, есть пробелы |
| < 10 | Нужен серьёзный рост |

---

## Формат сдачи

1. Сделать **fork** данного репозитория (или создать свой репозиторий)  
2. Реализовать задание  
3. Отправить ссылку на GitHub с решением  

---

Удачи и до встречи на техническом интервью!
